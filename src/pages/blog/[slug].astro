---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.vue";
import SocialSidebar from "../../components/SocialSidebar.vue";
import EmailSidebar from "../../components/EmailSidebar.vue";
import LetsConnect from "../../components/LetsConnect.vue";
import ContentLayout from "../../components/ContentLayout.vue";
import { getBlogs, getBlogBySlug } from "../../lib/content";

export async function getStaticPaths() {
  const items = await getBlogs();
  return items.map((item: any) => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
const content = await getBlogBySlug(slug);

if (!content) {
  throw new Error(`Blog not found: ${slug}`);
}

const pageTitle = content.metaTitle || `${content.title} - Mayuresh Mule`;
const pageDescription =
  content.metaDescription || "Blog post from the portfolio of Mayuresh Mule.";
---

<Layout title={pageTitle} description={pageDescription}>
  <Header audioFile={content.audioFile} client:load />
  <SocialSidebar client:load />
  <EmailSidebar client:load />

  <main class="px-16 md:px-32 py-20 pt-32">
    <ContentLayout content={content} client:visible />

    <div class="max-w-7xl mx-auto">
      <LetsConnect client:visible />
    </div>
  </main>
</Layout>
